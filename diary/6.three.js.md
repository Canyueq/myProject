# 1.29

## [**基于物理的渲染**](https://en.wikipedia.org/wiki/Physically_based_rendering) （PBR）

MeshStandardMaterial

physicallyCorrectLights已在 Three.js r155+ 版本中被移除

现在renderer默认开启显示物理光照|不能关闭，也不应该关闭

## DirctionLight

定向光源

```
function createLights() {
  // Create a directional light
  //创建定位灯光，传入颜色和光强
  const light = new DirectionalLight("white", 8);

  //设置灯源位置
  light.position.set(10, 10, 10);

  return light;
}
```

## 材质

MeshBasicMaterial，不具有现实效果的材质

MeshStandardMaterial,基于物理效果的材质

## 解耦main函数

将初始化world和渲染分布进行，可以方便操纵

## World类

通过私有化成员属性的方式，方便回收

```
class World {
  private camera: PerspectiveCamera;
  private renderer: WebGLRenderer;
  private scene: Scene<Object3DEventMap>;
  private cube: Mesh; // ✅ 添加类型
  private light: Light; // ✅ 添加类型
  private resizer: Resizer;
  constructor(
    container: HTMLElement,
    lightPositon?: Position,
    rotation?: Position,
  ) {
    this.camera = createCamera();
    this.scene = createScene();
    this.renderer = createRenderer();
    container.append(this.renderer.domElement);
    this.scene.background = new Color("red");
    this.cube = createCube(lightPositon);
    this.light = createLights(lightPositon);

    this.scene.add(this.cube, this.light);

    this.resizer = new Resizer(container, this.camera, this.renderer);
    // Set the camera's aspect ratio to match the container's proportions
    this.camera.aspect = container.clientWidth / container.clientHeight;

    // next, set the renderer to the same size as our container element
    this.renderer.setSize(container.clientWidth, container.clientHeight);

    // finally, set the pixel ratio to ensure our scene will look good on mobile devices
    this.renderer.setPixelRatio(window.devicePixelRatio);
  }

  render() {
    this.renderer.render(this.scene, this.camera);
  }

  dispose() {
    // 1. 从场景中移除对象
    this.scene.remove(this.cube, this.light);

    // 2. 从 DOM 中移除 renderer 的 canvas
    if (this.renderer.domElement.parentNode) {
      this.renderer.domElement.parentNode.removeChild(this.renderer.domElement);
    }

    // 4. 释放 Three.js 资源
    this.renderer.dispose(); // 释放 WebGL 上下文

    // 5. 释放几何体和材质（防止 GPU 内存泄漏）
    this.cube.geometry.dispose();

    // 6. （可选）如果 light 有自定义资源，也清理（通常不需要）

    // 7. 断开引用（帮助 GC）
    this.camera = null!;
    this.renderer = null!;
    this.scene = null!;
    this.cube = null!;
    this.light = null!;
    this.resizer = null!;
  }
}
```


